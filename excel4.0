Private Sub CommandButton1_Click()
    
   
    lastRow = Worksheets("Calculator Bilant").Range("A" & Rows.Count).End(xlUp).Row
   
    lastRow2 = Worksheets("Working Table Balanta").Range("A" & Rows.Count).End(xlUp).Row
    
    Dim sumVar      As Double

    For i = 2 To lastRow
        Do
            sumVar = 0
            
            currentList = Worksheets("Calculator Bilant").Range("D" & i).Value
            
            Dim SplitArray() As String
            
            
            currentList = Replace(currentList, "-", "+-")
            
            If InStr(currentList, "+") > 0 Then
               
                SplitArray = Split(currentList, "+")
               
            ElseIf IsEmpty(currentList) Or currentList = "" Then
        
                Exit Do
               
            Else
                
                ReDim SplitArray(0) As String
               
                SplitArray(0) = currentList
            End If
            
            arrayLength2 = UBound(SplitArray)
           
            For j = 0 To arrayLength2
           
                currentAccount = SplitArray(j)
              
                Worksheets("Working Table Balanta").Activate
               
                For k = 2 To lastRow2
                   If Not IsNumeric(currentAccount) Then
                    
                        If currentAccount = "" Then
                            sumVar = sumVar
                        Else:
                            account = Split(currentAccount, "*")
                            'nr = UBound(account)
                            'If nr = 1 Then
                                'myStr = "?"
                            'ElseIf nr = 2 Then
                                'myStr = "??"
                            'End If
                                
                            wildCard = account(0) & "?"
                            If InStr(account(0), "-") > 0 Then
                                accountMinus = Split(currentAccount, "-")
                                wildCard = accountMinus(1) & "?"
                                semn = "minus"
                            Else:
                                semn = "plus"
                            End If
                            If Worksheets("Working Table Balanta").Range("A" & k).Value Like wildCard Or Worksheets("Working Table Balanta").Range("A" & k).Value = account(0) Then
                        
                                If semn = "minus" Then
                                    sumVar = sumVar - Worksheets("Working Table Balanta").Range("O" & k).Value
                                Else:
                                    sumVar = sumVar + Worksheets("Working Table Balanta").Range("O" & k).Value
                                End If
                            End If
                        End If
                    
                        
                   ElseIf InStr(currentAccount, "-") > 0 Then
                        account = Split(currentAccount, "-")
                        If CDbl(Worksheets("Working Table Balanta").Range("A" & k).Value) = CDbl(account(1)) Then
                            sumVar = sumVar - Worksheets("Working Table Balanta").Range("O" & k).Value
                        End If
                        
                    ElseIf CDbl(Worksheets("Working Table Balanta").Range("A" & k).Value) = CDbl(currentAccount) Then
                       
                        sumVar = sumVar + Worksheets("Working Table Balanta").Range("O" & k).Value
                    End If
                  
                Next k
            
            Next j
            
            Worksheets("Calculator Bilant").Activate
            Worksheets("Calculator Bilant").Range("G" & i).Select
            Cells(i, "G").Value = sumVar
        Loop While False
        Next i
    
End Sub

